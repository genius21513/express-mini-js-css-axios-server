"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}var myFormData=[],schemaName=serverData.parameters.schema.toLowerCase(),appName=serverData.menus.app.name,type=serverData.parameters.schema,dataType=serverData.parameters.schema,adminUrl=serverData.service.admin.services[0].url,ref=`/app/${appName}/data?schema=${type}`;for(let e in serverData.service.admin.schema.search){let t=serverData.service.admin.schema.search[e],a={data:t.name+"",className:t.css+"align-middle",orderable:t.orderable,searchable:t.searchable};myFormData.push(a)}var AdvanceDataTablesDemo=function(){function e(){_classCallCheck(this,e),this.init()}return _createClass(e,[{key:"init",value:function(){this.table=this.table(),this.globalSearch(),this.columnSearch(),this.selecter(),this.clearSelected(),this.addFilterRow(),this.removeFilterRow(),this.clearFilter(),this.table.buttons().container().appendTo("#dt-buttons").unwrap()}},{key:"table",value:function(){return $("#myTable").DataTable({dom:"<'text-muted'Bi>\n        <'table-responsive'tr>\n        <'mt-4'p>",buttons:["copyHtml5",{extend:"print",autoPrint:!1}],language:{paginate:{previous:'<i class="fa fa-lg fa-angle-left"></i>',next:'<i class="fa fa-lg fa-angle-right"></i>'}},autoWidth:!1,ajax:{url:adminUrl+"/"+schemaName+"s/?format=data",type:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+getCookie("idx")),e.setRequestHeader("Content-Type","application/json")}},deferRender:!0,order:[1,"asc"],columns:myFormData,columnDefs:[{targets:0,render:function(e,t,a,n){return'<div class="custom-control custom-control-nolabel custom-checkbox">\n            <input type="checkbox" class="custom-control-input" name="selectedRow[]" id="p'.concat(a.id,'" value="').concat(a.id,'">\n            <label class="custom-control-label" for="p').concat(a.id,'"></label>\n          </div>')}},{targets:1,render:function(e,t,a,n){let c=a.name;return void 0===c&&(c=a.text),void 0!==a.picture?'<a href="item?schema='+dataType+"&id=".concat(a.id,'" class="tile tile-img mr-1">\n            <img class="img-fluid" src="').concat(a.picture,'" alt="row image">\n          </a>\n          <a href="item?schema='+dataType+"&id=").concat(a.id,'">').concat(a.name,"</a>"):'<li class="list-group-item" style=\'padding: 1px\'>\n                          <div class="list-group-item-figure">\n                            <div class="tile bg-primary">\n                              <span class="'+a.icon+'"></span>\n                            </div>\n                          </div>\n                          <div class="list-group-item-body"> <a href=\'item?schema='+dataType+"&id="+a.id+"'>"+c+" </div></a>\n                        </li>"}},{targets:serverData.service.admin.schema.search.length,render:function(e,t,a,n){return""}},{targets:serverData.service.admin.schema.search.length+1,render:function(e,t,a,n){return'<a class="btn btn-sm btn-icon btn-secondary" href="item?schema='+dataType+"&id=".concat(a.id,'"><i class="fa fa-pencil-alt"></i></a>\n          <a class="btn btn-sm btn-icon btn-secondary" href="#" data-toggle="modal" onClick="displayValues(\''+a.id+"','"+a.name+'\')" data-target="#confirmDelete"').concat(a.id,'"><i class="far fa-trash-alt"></i></a>')}}]})}},{key:"globalSearch",value:function(){var e=this;$("#table-search").on("keyup focus",(function(t){var a=$("#table-search").val();a.length&&"keyup"===t.type&&e.clearSelectedRows(),e.table.search(a).draw()}))}},{key:"columnSearch",value:function(){var e=this;$(document).on("keyup change",".filter-control",(function(t){var a=$(this).parents(".form-row"),n=a.find(".filter-column").val(),c=a.find(".filter-value").val(),i=""===c?"contain":a.find(".filter-operator").val(),r=c,l="";if("notcontain"===i)r="^((?!"+c+").)*$";else if("equal"===i)r="^"+c+"$";else if("notequal"===i)r="^(?!"+c+").*$";else if("beginwith"===i)r="^("+c+"| "+c+").*";else if("endwith"===i)r=".*"+c+"$";else if("greaterthan"===i){var o=c.split("");$.each(o,(function(e,t){l+="["+t+"-9]"})),r="^("+l+"|[0-9][0-9]{"+o.length+",})*$"}else"lessthan"===i&&function(){for(var e=c.split(""),t=e.length-1,a=function(a){l+=a>0?"|":"",$.each(e,(function(e,n){e<=a&&a===t&&(l+="[0-"+n+"]"),e<=a&&a<t&&(l+="[0-9]")}))},n=0;n<e.length;n++)a(n);r="^("+l+")$"}();"change"===t.type&&$(t.target).is("select")&&a.find(".filter-value").val("").trigger("keyup"),e.table.column(n).search(r,!0,!0).draw()}))}},{key:"addFilterRow",value:function(){$("#add-filter-row").on("click",(function(){var e=$("#filter-columns").children().first().clone();e.find("select").prop("selectedIndex",0),e.find("input").val(""),$("#filter-columns").append(e)}))}},{key:"removeFilterRow",value:function(){var e=this;$(document).on("click",".remove-filter-row",(function(){var t=$(this).parents(".filter-row");t.find(".filter-value").val("").trigger("keyup"),e.isRemovableRow()&&t.remove()}))}},{key:"isRemovableRow",value:function(){return $("#filter-columns").children().length>1}},{key:"clearFilter",value:function(){var e=this;$(document).on("click","#clear-filter",(function(){$("#modalFilterColumns").modal("hide"),$("#filter-columns").find("select").prop("selectedIndex",0),$("#filter-columns").find("input").val(""),e.table.columns().search("").draw()}))}},{key:"selecter",value:function(){var e=this;$(document).on("change","#check-handle",(function(){var t=$(this).prop("checked");$('input[name="selectedRow[]"]').prop("checked",t),e.getSelectedInfo()})).on("change",'input[name="selectedRow[]"]',(function(){var t=$('input[name="selectedRow[]"]'),a=$('input[name="selectedRow[]"]:checked').length,n=a===t.length?"checked":"indeterminate";$("#check-handle").prop("indeterminate",!1).prop("checked",!1),a&&$("#check-handle").prop(n,!0),e.getSelectedInfo()}))}},{key:"clearSelected",value:function(){var e=this;$("#myTable").on("page.dt",(function(){e.clearSelectedRows()})),$("#clear-search").on("click",(function(){e.clearSelectedRows()}))}},{key:"getSelectedInfo",value:function(){var e=$('input[name="selectedRow[]"]:checked').length,t=$(".thead-btn"),a=$("<span/>").addClass("selected-row-info text-muted pl-1").text("".concat(e," selected"));$(".selected-row-info").remove(),e&&t.prepend(a)}},{key:"clearSelectedRows",value:function(){$("#check-handle").prop("indeterminate",!1).prop("checked",!1).trigger("change")}}]),e}(),deleteObject="N/A";function displayValues(e,t){deleteObject=e,$("#confirmTitle").text("Warning: Confirm delete of '"+t+"'")}function deleteItem(){console.log("should delete: <%= context.data.admin.service %>/<%= context.parameters.schema.toLowerCase() %>s/delete/"+deleteObject)}$(document).on("theme:init",(function(){new AdvanceDataTablesDemo}));